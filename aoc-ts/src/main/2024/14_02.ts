import { variance } from "../utils/arrays.ts";
import { parse, simulate } from "./14_01.ts";

export function solve(input: string): number {
  // magic numbers not part of the input
  const w = 101;
  const h = 103;

  // parse input
  const robots = parse(input);

  // I had no idea how to solve this problem.
  // Initially I printed out all `w*h` simulations to a file and looked up the solution using ctrl+F "111111111111" (it worked :p).
  //
  // I found some hints on the AoC subreddit (there are many approaches)
  // https://old.reddit.com/r/adventofcode/comments/1hdvhvu/2024_day_14_solutions/m1z79gn/
  // > nice trees are compressible and will have a smaller file size and everything else looks like random noise

  // minimize the estimated information entropy using variance as a proxy
  let mvar = Infinity;
  let mt = -1;
  for (let i = 1; i <= w * h; i++) {
    simulate(1, w, h, robots);

    const xs = robots.map((r) => r[0][0]);
    const ys = robots.map((r) => r[0][1]);

    const xvar = variance(xs);
    const yvar = variance(ys);
    const cvar = xvar + yvar;

    if (cvar < mvar) {
      mvar = cvar;
      mt = i;
    }
  }

  return mt;
}

// t = 8087
// ................................................................................1....................
// .................................................1...................................................
// ..............................................1......................................................
// ................1.1............................1.....................................................
// .................................................................................1...................
// ................................................................................................1....
// ..1..................................................................................................
// .....1........................................................................................1......
// .1...................................................................................................
// .....................................................................................................
// ...........................................................1...........1........1....................
// .........1..........................................1.........1......................................
// ..............................................1........1.............................................
// .......................................1..........1..................................................
// ...................................................................................1.............1...
// ............................................................1........................................
// .................1.......................1.............................1.............................
// .............................1.......................................................................
// .................................1...............................1.........................1.........
// .........1........................1..........................................1.......................
// .....................................................................................................
// .............................1.......................................................................
// .......1.............................1....1..........................................................
// ...1..............................................................1......................1...........
// ..........................1............................................1.............................
// .......................................................................................1.............
// ..............................................1......................................................
// .............1.......................................................................1...............
// ............1.................................1.....1.......................................1........
// .....................................................................................................
// ................1111111111111111111111111111111......................................................
// ................1.............................1......................................................
// ................1.............................1.....1........................1.......................
// ................1.............................1.................1....................................
// ................1.............................1......................................................
// ................1..............1..............1......................................................
// ................1.............111.............1....1.........................................1.......
// ................1............11111............1......................................................
// ................1...........1111111...........1......................................................
// ................1..........111111111..........1......................................................
// 1.....1.........1............11111............1......................................................
// ................1...........1111111...........1......................................................
// ................1..........111111111..........1....................1...............................1.
// ................1.........11111111111.........1........................................1.............
// ...1......1.....1........1111111111111........1..1...................................................
// ................1..........111111111..........1..............1.....................................1.
// ................1.........11111111111.........1......................................................
// ................1........1111111111111........1............................................1.........
// ................1.......111111111111111.......1......................................................
// ..........1.....1......11111111111111111......1......................................................
// ................1........1111111111111........1..........................1.........1.................
// ................1.......111111111111111.......1....................................................1.
// 1.......1.......1......11111111111111111......1......................................................
// ................1.....1111111111111111111.....1......................................................
// ................1....111111111111111111111....1..1...................................................
// ................1.............111.............1..........1...........................................
// ................1.............111.............1......................1...............................
// ................1.............111.............1..........................1...........................
// ................1.............................1.......................1..............................
// ................1.............................1....................................1.................
// ................1.............................1......................................1...............
// ......1.........1.............................1......................................................
// ................1111111111111111111111111111111............................1.........................
// .....................................................................................................
// ...............1...........................................1.........................................
// .........................................1...........................................................
// ...................1.........................................................1.......................
// .....................................1.............................................................1.
// ...........................1....................1....................................................
// ..........................................................1...........................1..............
// .....................................................................................................
// ..1............1................1............................................1.......................
// ........................................1..1.........................................................
// ...........1......................................................................1..................
// ............1..........1...............................................................1.1...........
// ............................................................1........................................
// ...1......................................................................1..........................
// .....1...............................................................................................
// .....................................................................................................
// .....................................................................................................
// ............................................1......................................1.................
// ...............1............................................................1........................
// ........................................1............................................................
// ............1..1.....................................................................................
// ...........1.............1.................1.........................................................
// ................................1....................................................................
// .........1.................................1.........................................................
// .......................1............................................................................1
// ...............1.....................................................................................
// ..............................1.1....................................................................
// .....................................................................................................
// .....................................................................................................
// ...........1.........................................................................................
// .........................................................................................1...........
// ..........................1..........................................................................
// ...............................1.......................1.............................................
// ...............1.....................................................................................
// ...........1...............................1.........................................................
// .................1.................1............................................1...1................
// ...................................................................................................1.
// ...............................................................................1.....................
// ....1...................................................................1............................
// ........1...................1.....................1..................................................
